{% extends "base.html" %}
{% load static %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/farm_details.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block title %}{{ farm.name }} - Weather Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="left-panel">
        <div class="farm-actions">
            <a href="{% url 'edit_farm' farm.id %}" class="btn btn-edit">Edit Farm</a>
            <a href="{% url 'farm_list' %}" class="btn btn-expert">All Farms</a>
            <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Logout</button>
            </form>
        </div>
        <div class="farm-info">
            <h2>{{ farm.name }} Farm</h2>
            <p><i class="fas fa-map-marker-alt"></i> {{ farm.location }}</p>
        </div>
        <div class="current-weather">
            <div class="date-time">
                <p><i class="far fa-calendar-alt"></i> {{ selected_forecast.date|date:"l, d M Y" }}</p>
                <p><i class="far fa-clock"></i> {{ selected_forecast.forecasts.0.time }}</p>
            </div>
            <div class="current-temp">
                {% with weather_main=selected_forecast.weather_main|lower %}
                    {% if 'clear' in weather_main %}
                        <i class="fas fa-sun fa-4x"></i>
                    {% elif 'cloud' in weather_main %}
                        <i class="fas fa-cloud fa-4x"></i>
                    {% elif 'rain' in weather_main %}
                        <i class="fas fa-cloud-rain fa-4x"></i>
                    {% elif 'snow' in weather_main %}
                        <i class="fas fa-snowflake fa-4x"></i>
                    {% elif 'thunderstorm' in weather_main %}
                        <i class="fas fa-bolt fa-4x"></i>
                    {% elif 'mist' in weather_main or 'fog' in weather_main %}
                        <i class="fas fa-smog fa-4x"></i>
                    {% else %}
                        <i class="fas fa-cloud-sun fa-4x"></i>
                    {% endif %}
                {% endwith %}
                <h1>{{ selected_forecast.temp|floatformat:0 }}°</h1>
            </div>
            <div class="weather-condition">
                <p>{{ selected_forecast.weather_main }}</p>
            </div>
        </div>
        <div class="seven-day-forecast">
            <h3>7 Days Forecast</h3>
            <div class="forecast-list">
                {% for day in forecast_data %}
                    <a href="?day={{ forloop.counter0 }}" class="forecast-day {% if forloop.counter0 == selected_day %}selected{% endif %}">
                        <div class="forecast-icon">
                            {% with weather_main=day.weather_main|lower %}
                                {% if 'clear' in weather_main %}
                                    <i class="fas fa-sun fa-2x"></i>
                                {% elif 'cloud' in weather_main %}
                                    <i class="fas fa-cloud fa-2x"></i>
                                {% elif 'rain' in weather_main %}
                                    <i class="fas fa-cloud-rain fa-2x"></i>
                                {% elif 'snow' in weather_main %}
                                    <i class="fas fa-snowflake fa-2x"></i>
                                {% elif 'thunderstorm' in weather_main %}
                                    <i class="fas fa-bolt fa-2x"></i>
                                {% elif 'mist' in weather_main or 'fog' in weather_main %}
                                    <i class="fas fa-smog fa-2x"></i>
                                {% else %}
                                    <i class="fas fa-cloud-sun fa-2x"></i>
                                {% endif %}
                            {% endwith %}
                        </div>
                        <div class="forecast-temp">
                            <span class="max-temp">+{{ day.temp_max|floatformat:0 }}°</span>
                            <span class="min-temp">/{{ day.temp_min|floatformat:0 }}°</span>
                        </div>
                        <div class="forecast-date">
                            <p>{{ day.date|date:"d M" }}</p>
                            <p>{{ day.date|date:"D" }}</p>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </div>
        <div class="farm-actions">
            <a href="{% url 'edit_farm' farm.id %}" class="btn btn-edit">Edit Farm</a>
            <a href="{% url 'farm_list' %}" class="btn btn-expert">All Farms</a>
            <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Logout</button>
            </form>
        </div>
    </div>

    <div class="right-panel">
        <div class="weather-header">
            <h1><i class="fas fa-chart-line"></i> Weather Forecast Dashboard</h1>
            <p><i class="fas fa-info-circle"></i> Check out today's weather information</p>
        </div>
        <div class="todays-highlight">
            <h3><i class="fas fa-star"></i> Day's Highlight</h3>
            <div class="highlight-grid">
                <div class="highlight-card">
                    <h4><i class="fas fa-tint"></i> Humidity</h4>
                    <p>{{ selected_forecast.humidity|default_if_none:"-" }}%</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-wind"></i> Wind</h4>
                    <p>{{ selected_forecast.wind_speed|default_if_none:"-"|floatformat:2 }} m/s</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-thermometer-half"></i> Feels Like</h4>
                    <p>{{ selected_forecast.feels_like|default_if_none:"-"|floatformat:0 }}°</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-cloud-rain"></i> Rainfall</h4>
                    <p>{{ selected_forecast.rainfall|default_if_none:"-"|floatformat:2 }} mm</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-umbrella"></i> Probability of Precipitation</h4>
                    <p>{{ selected_forecast.pop|default_if_none:"-"|floatformat:0 }}%</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-cloud"></i> Cloudiness</h4>
                    <p>{{ selected_forecast.clouds|default_if_none:"-" }}%</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-eye"></i> Visibility</h4>
                    <p>{{ selected_forecast.visibility|default_if_none:"-"|floatformat:-3 }} km</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-compress-alt"></i> Pressure</h4>
                    <p>{{ selected_forecast.pressure|default_if_none:"-" }} hPa</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-temperature-high"></i> Max Temperature</h4>
                    <p>{{ selected_forecast.temp_max|default_if_none:"-"|floatformat:0 }}°</p>
                </div>
                <div class="highlight-card">
                    <h4><i class="fas fa-temperature-low"></i> Min Temperature</h4>
                    <p>{{ selected_forecast.temp_min|default_if_none:"-"|floatformat:0 }}°</p>
                </div>
            </div>
        </div>
        <div class="crop-recommendations">
            <h3><i class="fas fa-seedling"></i> Recommended Crops</h3>
            <div class="crop-list">
                {% for crop in crop_recommendations %}
                    <div class="crop-card">
                        <h4><i class="fas fa-leaf"></i> {{ crop.crop_name }}</h4>
                        <p><i class="fas fa-chart-line"></i> Yield: {{ crop.predicted_yield|floatformat:2 }} units/acre</p>
                        <p><i class="fas fa-check-circle"></i> Suitability: {{ crop.suitability|floatformat:2 }}</p>
                        <p><i class="fas fa-percentage"></i> Confidence: {{ crop.confidence|floatformat:2 }}%</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}