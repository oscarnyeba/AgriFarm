{% extends "base.html" %}

{% block title %}{{ farm.farm_name }}{% endblock %}

{% block content %}
    <h1>{{ farm.farm_name }}</h1>
    <p>Location: {{ farm.location }}</p>
    <p>Total Area: {{ farm.total_area }} hectares</p>
    {% if request.user == farm.user %}
        <a href="{% url 'edit_farm' farm.id %}" class="btn btn-primary mb-3">Edit Farm</a>
    {% endif %}

    <!-- Weather Data Section -->
    <h2>Current Weather Data for {{ farm.location }}</h2>
    {% if weather_info %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Temperature (°C)</th>
                    <th>Humidity (%)</th>
                    <th>Rainfall (mm)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ today }}</td>  <!-- Ensure today is defined in the view -->
                    <td>{{ weather_info.temperature }}</td>
                    <td>{{ weather_info.humidity }}</td>
                    <td>{{ weather_info.rainfall }}</td>
                </tr>
            </tbody>
        </table>
    {% else %}
        <p>No current weather data available.</p>
    {% endif %}
    <a href="{% url 'add_weather_data' farm.id %}" class="btn btn-success">Add Weather Data</a>

    <!-- Historical Weather Data Section -->
    <h2>Weather History</h2>
    {% if weather_data %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Temperature (°C)</th>
                    <th>Humidity (%)</th>
                    <th>Rainfall (mm)</th>
                </tr>
            </thead>
            <tbody>
                {% for data in weather_data %}
                    <tr>
                        <td>{{ data.date }}</td>
                        <td>{{ data.temperature }}</td>
                        <td>{{ data.humidity }}</td>
                        <td>{{ data.rainfall }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No historical weather data available.</p>
    {% endif %}

    <!-- Recommendations Section -->
    <h2>Recommended Crops Based on Current Weather</h2>
    {% if recommendations %}
        <ul>
            {% for crop in recommendations %}
                <li>{{ crop.crop_name }} - Suitable for current conditions</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No crops recommended based on current weather conditions. Please check back later or adjust the farm conditions.</p>
    {% endif %}

    <!-- Soil Information Section -->
    <h2>Soil Information</h2>
    {% if soil_info %}
        <h3>Soil Types</h3>
        <ul>
            {% for type, details in soil_info.soil_types.items %}
                <li>{{ type }}: {{ details }}</li>
            {% endfor %}
        </ul>

        <h3>Soil Properties</h3>
        <ul>
            {% for property, value in soil_info.soil_properties.items %}
                <li>{{ property }}: {{ value }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No soil data available for this location.</p>
    {% endif %}

{% endblock %}
